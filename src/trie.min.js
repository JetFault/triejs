/**
* Copyright (C) 2011 Paul Thurlow
*
* Permission is hereby granted, free of charge, to any person obtaining a copy 
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*/
(function(){var a=function(c){this.options={maxCache:10,enableCache:true,insert:null,sort:null,clip:null,copy:null};this.root={};for(var b in c){if(c.hasOwnProperty(b)){this.options[b]=c[b]}}if(typeof this.options.insert!="function"){this.options.insert=function(e,d){if(e.length){e.push(d)}else{e=[d]}return e}}if(typeof this.options.sort!="function"){this.options.sort=function(){this.sort()}}if(typeof this.options.clip!="function"){this.options.clip=function(d){if(this.length>d){this.splice(0,this.length-d)}}}if(typeof this.options.copy!="function"){this.options.copy=function(d){return d.slice(0)}}};a.prototype={_addCacheData:function(c,b){if(c==this.root||this.options.enableCache===false){return}if(!c.data){c.data={}}c.data=this.options.insert.call(this,c.data,b);this.options.sort.call(c.data);this.options.clip.call(c.data,this.options.maxCache)},_addSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={data:{}};if(b){c.suffix=b}f[d]=c;f[d].data=this.options.insert.call(this,f[d].data,e)},_moveSuffix:function(g,e,f){var d=g.charAt(0),b=g.substring(1)||null,c={data:{}};if(b){c.suffix=b}f[d]=c;f[d].data=this.options.copy(e)},addWord:function(g,e){if(typeof g!="string"){return false}g=g.toLowerCase();var f=this.root;for(var b=0,c=g.length;b<c;b++){var d=g.charAt(b);if(!f[d]){if(f.suffix){this._moveSuffix(f.suffix,f.data,f);delete f.suffix;if(this.options.enableCache===false){delete f.data}}if(!f[d]){this._addSuffix(g.substring(b),e,f);this._addCacheData(f,e);break}this._addCacheData(f,e);if(b==c-1){if(f[d].suffix){this._moveSuffix(f[d].suffix,f[d].data,f[d]);delete f[d].suffix;if(this.options.enableCache===false){delete f[d].data}}this._addCacheData(f[d],e)}f=f[d]}else{if(b==c-1){this._addCacheData(f,e);this._addCacheData(f[d],e)}else{this._addCacheData(f,e);f=f[d]}}}},getPrefix:function(e){if(typeof e!=="string"){return undefined}e=e.toLowerCase();var f=this.root;for(var b=0,c=e.length;b<c;b++){var d=e.charAt(b);if(!f[d]){if(f.suffix&&f.suffix.indexOf(e.substring(b))==0){return this.options.enableCache?f.data:this.getSubtree(f)}else{return undefined}}else{f=f[d]}}return this.options.enableCache?f.data:this.getSubtree(f)},getSubtree:function(h){var d=[],g=[h],f;while(f=g.pop()){for(var c in f){if(f.hasOwnProperty(c)){if(c=="data"){for(var b=0,e=f.data.length;b<e;b++){d=this.options.insert.call(this,d,f.data[b]);this.options.sort.call(d);this.options.clip.call(d,this.options.maxCache)}}else{if(c!="suffix"){g.push(f[c])}}}}}return d}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports.Triejs=a}else{if(typeof define==="function"&&define.amd){define("triejs",function(){return a})}else{this["Triejs"]=a}}})(this);